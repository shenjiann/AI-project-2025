<!-- 配置 MathJax -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['\\[', '\\]'], ['$$', '$$']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>


<!-- 加载 MathJax 主脚本 -->
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


<!-- 接收refresh-mathjax触发渲染 -->
<script>
  Shiny.addCustomMessageHandler("refresh-mathjax", function(_) {
    if (window.MathJax && MathJax.typesetPromise) {
      MathJax.typesetPromise();
    }
  });
</script>


<!-- 在会话初始化完成后发送消息 -->
<script>
  $(document).on('shiny:sessioninitialized', function(event) {
  setTimeout(function() {
      Shiny.setInputValue('init_mathjax', true, {priority: "event"});
  }, 10); // 添加10ms延迟确保会话完全就绪
  });
</script>